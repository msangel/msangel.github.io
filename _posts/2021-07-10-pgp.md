---
title: Основы работы с GnuPG
date: 2021-07-10 09:41:00 Z
---

пс.: я конечно заебался с этим но надо разобраться до конца

пс2.: помню с ключами ssh тоже долго вникал в логику работы, щас с закрытыми глазами выдаю публичный ключ в консоль одной рукой, а другой вношу его в `.ssh/authorized_keys`, поэтому и с этим разберусь

пс3: в докере и с фейковыми данными, а то и так уже имею два ключа на мое имя

### Создадим тестовую среду
Пропустить этот шаг если уверен в своих силах.
Контейнер:
> docker run -it --rm ubuntu

Установим необходимые библиотеки:
```bash
apt update && apt install gnupg2 -y
```
<details>
<summary markdown='span'>Разница между gnupg и gnupg2</summary>
  
Вторая версия этой программы хоть и совместима с первой на уровне протокола(т.е. с точки зрения использования они взаимозаменяемые), но по факту переписана с нуля. Также изменен подход к формату сохраниния ключей, однако в целях совместимости вторая версия будет использовать старый формат, если в системе есть хотя бы один keyring в старом формате. Первая версия в современных дистрибутивах помечена как `deprecated`, и хотя её еще можно поставить параллельно с второй и пользоваться, но зачем? Сама же команда `gpg` в современных дистрибутивах это просто синоним для `gpg2`, с добавлением некоторой магии совместимости.
Больше об этом:

 - https://superuser.com/questions/655246/are-gnupg-1-and-gnupg-2-compatible-with-each-other

</details>
Также есть очень удобная для работы GUI-тулза: gpa. Установить её можно так:
```bash
sudo apt install gpa
```
Она полноценна настолько, что я пожалуй сделаю отдельно обзор на неё. Но в рамках этой статьи будем работать с консольной `gnupg2`.

### Что мы установили
Подробней о инструменте можно почитать на его [сайте](https://www.gnupg.org/related_software/gpa/index.html), но если в кратце, то это такой мультикомбайн в мире криптографии.  В корне проекта стоит именно спецификация, поэтому существуют и альтернативные реализации, и очень интересные расширения.  Спецификация описывает использование симметричной криптографии и криптографии с открытым ключем, может применяться как для шифрования файлом, так и целых дисков.

Самым частым сценарием использования является "**гибридная криптография**". В целом её суть такова:
**Для шифрования** создается сеансовый ключ симметричного шифрования, им шифруются данные, потом открытым ключе) шифруется сам сеансовый ключ и передается вместе с шифрованными данными
**Для расшифрования** закрытым ключем расшифровуется сеансовый ключ, а потом ним разшифровуется само сообщение.
Таким образом эта схема имеет удобство асимметричной криптографии на публичных ключах и скорость работы симетричной криптографии. 

### Публичные сервера
Для публикации публичных ключей используются специальные публичные сервера (keyserver). 
<details>
<summary markdown='span'>Список публичных серверов для публичных ключей</summary>

- `keyserver.ubuntu.com` (recomended, supported by maven central)
- `keys.openpgp.org` (supported by maven central)
- `pgp.mit.edu` (supported by maven central)
- `keyserver.pgp.com`
</details>

### Исследуем файлы и возвожности
Для того, чтоб узнать достатучную иформация об установленой программе, её файлах и среде, достаточно выполнить эту команду:
```bash
gpg --version
``` 
Пример ответа ниже:
```
gpg (GnuPG) 2.2.19
libgcrypt 1.8.5
Copyright (C) 2019 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <https://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Home: /root/.gnupg
Supported algorithms:
Pubkey: RSA, ELG, DSA, ECDH, ECDSA, EDDSA
Cipher: IDEA, 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH,
        CAMELLIA128, CAMELLIA192, CAMELLIA256
Hash: SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224
Compression: Uncompressed, ZIP, ZLIB, BZIP2
```
Из ответа мы узнали о версии программы, поддерживаемых алгоритмах шифрования и компрессии и о месте, где все ключи будут храниться.
К слову, это место можно изменить, установив переменную окружения:
```bash
export GNUPGHOME=/path/to/the/folder
```
Что находится в папке home? Начнем с того, что пока мы не создали ниодного ключа, эта папка еще даже не существует:
```bash
# ls -la /root/.gnupg
ls: cannot access '/root/.gnupg': No such file or directory
```
Дальше в процессе работы будем следить как будет меняться сместимое этой папки.
Для того, чтоб получить справку по использовании программы, можно возпользоваться и стандартными для этого средствами(в наличии только в нормальных системах):
```bash
man gpg2 | cat
```
<details>
<summary markdown='span'>Если работаем с докером</summary>

- `keyserver.ubuntu.com` (recomended, supported by maven central)
- `keys.openpgp.org` (supported by maven central)
- `pgp.mit.edu` (supported by maven central)
- `keyserver.pgp.com`
</details>












Read more:
 - https://central.sonatype.org/publish/requirements/gpg/ - о требовании подписывать артефакты и как это сделать
 - https://blogs.itemis.com/en/openpgp-on-the-job-part-3-install-and-configure
 - https://docs.nitrokey.com/pro/openpgp-keygen-gpa.html
	 - https://github.com/rvm/rvm/issues/3544
	 - https://stackoverflow.com/questions/66217436/gpg-keyserver-receive-failed-no-name
	 - https://keyserver.ubuntu.com/
	 - https://oss.sonatype.org/#welcome
 - https://maven.apache.org/plugins/maven-gpg-plugin/examples/deploy-signed-artifacts.html
 - https://gist.githubusercontent.com/msangel/60a76537f3154f9ead205431bc5a05cc/raw/06175105b6e15f245b5c18d633b85bd6ffe0fb65/pgp.md

> Written with [StackEdit](https://stackedit.io/).
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTgzMjg3Mjk5NCwxODY4ODc5NTYsMTcwNz
cxMjQ5OCwtMTEwNjQwMTU1NCwxMDg5MzM3MDAxLC0xMDQ2MDgz
MDk5LC0xNTc3ODAzMTM4LC01ODcxODk0OTUsLTUyMzgzMTYyNy
wtMjE0NDE1OTAwNywtMTA4NzAzNzYwMSwxODM4MDY4NDIxXX0=

-->